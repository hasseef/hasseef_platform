<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ููุตุฉ ุญุตูู ุงููุทููุฉ ููุชูุงูู ุงูุชูููู โ V3</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{--royal:#0B3B74;--gold:#D4AF37;--slate:#0f172a;--muted:#475569;--bg:#F6F7F9;--border:#e2e8f0}
:root.dark{--bg:#0b1220;--slate:#e5e7eb;--muted:#94a3b8;--border:#334155}
*{box-sizing:border-box}html{scroll-behavior:smooth}
body{margin:0;font-family:'Tajawal',system-ui,Arial;background:var(--bg);color:var(--slate)}
a{color:var(--royal);text-decoration:none}button{cursor:pointer}
.header{background:var(--royal);color:#fff;border-bottom:4px solid var(--gold)}
.container{max-width:1200px;margin:0 auto;padding:16px}
.flex{display:flex;align-items:center;gap:12px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:800px){.row{grid-template-columns:1fr}}
.brand{font-weight:900;font-size:18px;display:flex;gap:10px;align-items:center}
.brand img{height:34px}
.nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;flex:1}
.nav a{color:#fff;opacity:.92;padding:6px 8px;border-radius:8px}
.nav a.active{opacity:1;background:rgba(255,255,255,.12)}
.badge{display:inline-block;border:1px solid var(--gold);color:var(--royal);border-radius:999px;padding:6px 12px;font-size:12px;background:#fff}
.btn{display:inline-block;background:#1e40af;color:#fff;border:2px solid var(--gold);padding:10px 14px;border-radius:12px;font-weight:700}
.hero{padding:24px 0}
.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:18px;margin:12px 0}
.grid{display:grid;gap:12px}
.grid-2{grid-template-columns:repeat(2,1fr)}
.grid-3{grid-template-columns:repeat(3,1fr)}
.grid-4{grid-template-columns:repeat(4,1fr)}
@media(max-width:1024px){.grid-4{grid-template-columns:repeat(2,1fr)}}
@media(max-width:640px){.grid-3,.grid-4,.grid-2{grid-template-columns:1fr}}
.tile{background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px;display:flex;gap:12px;align-items:flex-start;transition:.2s}
.tile:hover{border-color:var(--gold);box-shadow:0 6px 16px rgba(0,0,0,.05)}
.icon{width:44px;height:44px;border-radius:50%;border:1px solid var(--gold);display:flex;align-items:center;justify-content:center;background:#fff}
.small{font-size:12px;color:var(--muted)}
.center{text-align:center}
.footer{padding:20px 0;border-top:1px solid var(--border);color:var(--muted);font-size:14px}
.input,select,textarea{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px;background:#fff}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border:1px solid var(--border);padding:10px 12px;font-size:14px;text-align:right;vertical-align:top}
.table th{background:#f8fafc}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
.modal .box{background:#fff;border-radius:16px;border:1px solid var(--border);max-width:820px;width:100%;padding:16px}
.hidden{display:none!important}
.logoRow{display:flex;gap:8px;align-items:center}
.kit{display:none}

/* ูุถุน ูููู ูุนูุงุตุฑ ุฑุฆูุณูุฉ */
html.dark body{background:var(--bg);color:var(--slate)}
html.dark .header{background:#0a2540}
html.dark .card{background:#0f172a;border-color:var(--border)}
</style>
</head>
<body>
<header class="header">
  <div class="container flex" style="justify-content:space-between">
    <!-- ูููู: ุดุนุงุฑ ุญุตูู -->
    <a class="brand logoRow" href="#home" title="ููุตุฉ ุญุตูู">
      <img src="assets/hasseef.png" alt="Hasseef" onerror="this.style.display='none'">
      <span id="brandTitle">ููุตุฉ ุญุตูู ุงููุทููุฉ ููุชูุงูู ุงูุชูููู</span>
    </a>

    <!-- ุงูููุชุตู: ูุงุฆูุฉ -->
    <nav class="nav" id="topNav">
      <a href="#home" data-i18n="home" class="active">ุงูุฑุฆูุณูุฉ</a>
      <a href="#about" data-i18n="about">ุนู ุงูููุตุฉ</a>
      <a href="#login" data-i18n="accounts">ุงูุญุณุงุจุงุช</a>
      <a href="#register" data-i18n="register">ุชุณุฌูู</a>
      <a href="#map" data-i18n="map">ุงูุฎุฑุงุฆุท</a>
      <a href="#govvalue" data-i18n="govValue">ุงููููุฉ ุงูุญููููุฉ</a>
      <a href="#funding" data-i18n="funding">ุงูุชูููู/ุงูุฑุนุงูุงุช</a>
      <a href="#docs" data-i18n="docs">ุงููุซุงุฆู</a>
      <a href="#subscriptions" data-i18n="subscriptions">ุงูุงุดุชุฑุงูุงุช</a>
      <a href="#sponsors" data-i18n="sponsors">ุงูุฑุนุงุฉ</a>
      <a href="#support" data-i18n="support">ุงูุฏุนู</a>
      <a href="#policies" data-i18n="policies">ุงูุณูุงุณุงุช</a>
      <a href="#contact" data-i18n="contact">ุงุชุตู ุจูุง</a>
      <a href="#admin" data-i18n="admin">ุงูุฅุฏุงุฑุฉ</a>
    </nav>

    <!-- ูุณุงุฑ: ูุถุน ูููู + ูุบุฉ + ุดุนุงุฑุงุช -->
    <div class="flex" style="gap:10px;align-items:center">
      <button class="badge" id="themeBtn" title="ุชุจุฏูู ุงููุถุน">โ๏ธ/๐</button>
      <div class="lang">
        <button class="badge" onclick="setLang('ar')">ุนุฑุจู</button>
        <button class="badge" onclick="setLang('en')">English</button>
      </div>
      <a href="https://www.vision2030.gov.sa/" target="_blank" class="logoRow" title="Vision 2030">
        <img src="assets/vision2030.png" alt="Vision 2030" style="height:28px" onerror="this.style.display='none'">
      </a>
      <a href="https://talbiya.sa" target="_blank" class="logoRow" title="Talbiya R&D">
        <img src="assets/talbiya.png" alt="Talbiya" style="height:28px" onerror="this.style.display='none'">
      </a>
    </div>
  </div>
</header>

<!-- HOME -->
<section id="home" class="kit" style="display:block">
  <div class="hero">
    <div class="container">
      <div class="card">
        <h2>ููุตุฉ ูุทููุฉ ููุชูุงูู ุงูุชูููู</h2>
        <p class="small">ุงููุณุฎุฉ ุงูุฑุณููุฉ ุงูููุฌูุฉ ููููุงุฏุฉ โ 2025</p>
        <p>ุชููููู ุญุตูู ุงููุทุงุนุงุช ุงูุญููููุฉ ูุงูุฎุงุตุฉ ูุบูุฑ ุงูุฑุจุญูุฉ ูุงูุฌุงูุนุงุช ูุงููุงูุญูู ูุงูุฃูุฑุงุฏ ูู ุงูุชูุงูู ุนุจุฑ ุญุณุงุจุงุช ูุฎุฏูุงุช ููุญูุฏุฉ ูุฑุชุจุทุฉ ุจูุณุชูุฏูุงุช ุฑุคูุฉ 2030.</p>
        <div class="flex">
          <a class="btn" href="./docs/Hasseef_Official_Report_Main.pdf" target="_blank" data-i18n="download">ุชุญููู ุงููุซููุฉ ุงูุฑุณููุฉ</a>
          <a class="btn" href="#login" data-i18n="login">ุชุณุฌูู ุงูุฏุฎูู</a>
        </div>
      </div>
      <div class="card">
        <div class="logoRow" style="justify-content:space-between">
          <div class="logoRow"><img src="assets/vision2030.png" style="height:30px" onerror="this.style.display='none'"><span class="small">Vision 2030</span></div>
          <div class="logoRow"><img src="assets/talbiya.png" style="height:30px" onerror="this.style.display='none'"><span class="small">Talbiya R&D</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- GOV VALUE CARDS (ูุฎุชุตุฑ) -->
  <div class="container" id="govvalue">
    <h3>ุงููููุฉ ุงููุถุงูุฉ ุงูุญููููุฉ</h3>
    <div class="grid grid-4" id="govValueCards"></div>
    <div class="card center"><a class="btn" href="#govvalue-all">ุนุฑุถ ุฌููุน ุงูุชูุงุตูู ุงูุญููููุฉ</a></div>
  </div>
</section>

<!-- ABOUT -->
<section id="about" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุนู ุงูููุตุฉ</h3>
      <p>ุญุตูู ุฑุงุจุท ูุทูู ูุฑูุฒู ุจูู ุงููุทุงุนุงุช ููู ุฃุฏูุงุฑูุงุ ููููุฑ ุญุณุงุจุงุช ูุชุฎุตุตุฉุ ูุฎุฏูุงุช ูุดุชุฑูุฉุ ูููุญุงุช ูุคุดุฑุงุชุ ููุญูุธุฉ ุชูููู/ุฑุนุงูุฉุ ูุงุชูุงููุงุช ุฑูููุฉุ ูุน ุญูููุฉ ูุตูุงุญูุงุช.</p>
      <div class="grid grid-3">
        <div class="card"><strong>ุฃูุฏุงู</strong><p class="small">ุชูุงูู ูุดูุงููุฉ ูููุงุกุฉ ุฅููุงู ูููุงุณ ุฃุซุฑ.</p></div>
        <div class="card"><strong>ุฎุฏูุงุช</strong><p class="small">ูุดุงุฑูุน/ูุฑุต/ูุญุงูุธ/ุชูุงุฑูุฑ/ุชูุงูู API.</p></div>
        <div class="card"><strong>ุชูููู</strong><p class="small">ููุงุกูุฉ ูุน ูุคุดุฑุงุช ุฑุคูุฉ 2030.</p></div>
      </div>
    </div>
  </div>
</section>

<!-- LOGIN -->
<section id="login" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุจูุงุจุฉ ุฏุฎูู ุงูุญุณุงุจุงุช</h3>
      <div class="grid grid-4" id="accountTiles"></div>
    </div>
  </div>
</section>

<!-- REGISTER -->
<section id="register" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ</h3>
      <p class="small">ุงุฎุชุฑ ููุน ุงูุญุณุงุจุ ูุฃุฏุฎู ุจูุงูุงุชู ุงูุฃุณุงุณูุฉุ ุซู ูุงูู ุนูู ุงูุงุชูุงููุฉ ุงูุฑูููุฉ.</p>
      <div class="row">
        <div>
          <label>ููุน ุงูุญุณุงุจ</label>
          <select class="input" id="regType">
            <option value="individual">ุงูุฃูุฑุงุฏ</option>
            <option value="private">ุงููุทุงุน ุงูุฎุงุต</option>
            <option value="nonprofit">ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู</option>
            <option value="universities">ุงูุฌุงูุนุงุช</option>
            <option value="government">ุงูุญูููุฉ</option>
            <option value="donors">ุงููุงูุญูู</option>
            <option value="partners">ุงูุดุฑูุงุก ุงูุงุณุชุฑุงุชูุฌููู</option>
            <option value="dev_authorities">ููุฆุงุช ุงูุชุทููุฑ</option>
          </select>
        </div>
        <div><label>ุงุณู ุงููุณุชุฎุฏู</label><input class="input" id="regName" placeholder="Admin"></div>
      </div>
      <div class="row">
        <div><label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input class="input" id="regEmail" placeholder="name@example.com"></div>
        <div><label>ุงูุฏูุฑ</label>
          <select class="input" id="regRole">
            <option>Admin</option><option>ูุฏูุฑ</option><option>ูุดุบูู</option><option>ูุฑุงูุจ</option>
          </select>
        </div>
      </div>
      <div class="small" style="margin:8px 0">
        <input type="checkbox" id="regAgree"> <label for="regAgree">ุฃูุงูู ุนูู <a href="#agreement">ุงูุงุชูุงููุฉ ุงูุฑูููุฉ</a></label>
      </div>
      <div style="text-align:end">
        <button class="btn" onclick="doRegister()">ุฅูุดุงุก ุงูุญุณุงุจ</button>
      </div>
      <div id="regMsg" class="small hidden" style="margin-top:8px"></div>
    </div>
  </div>
</section>

<!-- MAP + KPIs + SVG -->
<section id="map" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุงูุฎุฑุงุฆุท ูุงููุคุดุฑุงุช ุงูุชููููุฉ</h3>
      <p class="small">ูุณุฎุฉ ุชุฌุฑูุจูุฉ ูุงุจูุฉ ููุงุณุชุจุฏุงู ุจู SVG/GeoJSON ูุงุญููุง.</p>
      <div class="row">
        <div>
          <label>ุงุฎุชุฑ ุงูููุทูุฉ</label>
          <select class="input" id="regionSel"></select>
          <div class="grid grid-3" style="margin-top:12px">
            <div class="card"><div class="small">ูุธุงุฆู</div><h2 id="kpiJobs">โ</h2></div>
            <div class="card"><div class="small">ููุญ</div><h2 id="kpiGrants">โ</h2></div>
            <div class="card"><div class="small">ูุชุทูุนูู</div><h2 id="kpiVols">โ</h2></div>
          </div>
        </div>
        <div>
          <canvas id="mapChart" height="180"></canvas>
          <p class="small">ุงููุฎุทุท ููุถุญ ุชูุฒูุน ุงููุฑุต ุญุณุจ ููุน ุงูุญุณุงุจ ูู ุงูููุทูุฉ ุงููุฎุชุงุฑุฉ.</p>
        </div>
      </div>

      <div class="card">
        <h4>ุฎุฑูุทุฉ ุงูุณุนูุฏูุฉ (ุชุฌุฑูุจูุฉ)</h4>
        <div id="ksaMap" style="overflow:auto">
          <svg viewBox="0 0 600 320" style="max-width:100%;height:auto;border:1px solid var(--border);border-radius:12px">
            <rect data-region="Riyadh"  x="260" y="120" width="140" height="80" fill="#e5e7eb" stroke="#cbd5e1"/>
            <rect data-region="Hail"    x="200" y=" 80" width="100" height="60" fill="#e5e7eb" stroke="#cbd5e1"/>
            <rect data-region="Makkah"  x="180" y="170" width="120" height="80" fill="#e5e7eb" stroke="#cbd5e1"/>
            <rect data-region="Madinah" x="120" y="120" width="120" height="70" fill="#e5e7eb" stroke="#cbd5e1"/>
            <rect data-region="Eastern" x="420" y="130" width="120" height="120" fill="#e5e7eb" stroke="#cbd5e1"/>
            <text x="290" y="160" font-size="12" fill="#475569">ุงูุฑูุงุถ</text>
            <text x="220" y="110" font-size="12" fill="#475569">ุญุงุฆู</text>
            <text x="200" y="210" font-size="12" fill="#475569">ููุฉ</text>
            <text x="140" y="160" font-size="12" fill="#475569">ุงููุฏููุฉ</text>
            <text x="450" y="190" font-size="12" fill="#475569">ุงูุดุฑููุฉ</text>
          </svg>
        </div>
        <p class="small">ุงููุฑ ููุทูุฉ ูู ุงูุฎุฑูุทุฉ ูุชุญุฏูุซ ุงููุคุดุฑุงุช ูุงููุฎุทุท.</p>
      </div>
    </div>
  </div>
</section>

<!-- DASHBOARD -->
<section id="dashboard" class="kit">
  <div class="container">
    <div class="card"><h3 id="dashTitle">ููุญุฉ ุงูุญุณุงุจ</h3></div>
    <div class="grid grid-3">
      <div class="card"><h4>ูุคุดุฑุงุช ุณุฑูุนุฉ</h4><canvas id="chartGrowth" height="140"></canvas></div>
      <div class="card"><h4>ุชูุฒูุน ูุฑุต ุงูููุญ</h4><canvas id="chartGrants" height="140"></canvas></div>
      <div class="card"><h4>ุฃุฏูุงุฑ ูุตูุงุญูุงุช</h4><p class="small" id="rolesBox"></p></div>
    </div>
    <div class="card"><h4>ุงูุฎุฏูุงุช</h4><ul id="servicesList" class="small"></ul></div>
  </div>
</section>

<!-- ADMIN -->
<section id="admin" class="kit">
  <div class="container">
    <div class="grid grid-3">
      <div class="card">
        <h4>ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</h4>
        <div class="row">
          <div><label>ุงูุงุณู</label><input class="input" id="uName" placeholder="ุงุณู ุงููุณุชุฎุฏู"></div>
          <div><label>ุงูุฏูุฑ</label><select class="input" id="uRole"><option>Admin</option><option>ูุฏูุฑ</option><option>ูุดุบูู</option><option>ูุฑุงูุจ</option></select></div>
        </div>
        <div class="row">
          <div><label>ุงูุญุณุงุจ</label><select class="input" id="uAccount">
            <option>individual</option><option>private</option><option>nonprofit</option><option>universities</option>
            <option>government</option><option>donors</option><option>partners</option><option>dev_authorities</option>
          </select></div>
          <div style="display:flex;align-items:end"><button class="btn" onclick="addUser()">ุฅุถุงูุฉ</button></div>
        </div>
        <hr>
        <table class="table" id="usersTbl"><thead><tr><th>ุงูุงุณู</th><th>ุงูุฏูุฑ</th><th>ุงูุญุณุงุจ</th><th></th></tr></thead><tbody></tbody></table>
      </div>

      <div class="card">
        <h4>ุทุจูุงุช ุงูุตูุงุญูุงุช</h4>
        <p class="small">ุชุญุฑูุฑ ุงูุตูุงุญูุงุช ููู ุฏูุฑ (ุนุฑุถ ุชุฌุฑูุจู).</p>
        <div class="row">
          <div><label>ุงูุฏูุฑ</label><select class="input" id="roleSel"><option>Admin</option><option>ูุฏูุฑ</option><option>ูุดุบูู</option><option>ูุฑุงูุจ</option><option>ุฒุงุฆุฑ</option></select></div>
          <div><label>ุงูุตูุงุญูุงุช</label><input class="input" id="rolePerms" placeholder="ูุซุงู: ูุฑุงุกุฉุ ุฅูุดุงุกุ ุงุนุชูุงุฏุ ุชูุงูู"></div>
        </div>
        <div style="margin-top:8px"><button class="btn" onclick="saveRole()">ุญูุธ</button></div>
        <hr><pre id="rolesOut" class="small" style="white-space:pre-wrap"></pre>
      </div>

      <div class="card">
        <h4>ุชูุงุฑูุฑ ุงููููุฉ ุงููุถุงูุฉ ุงููุทููุฉ</h4>
        <p class="small">ุฅูุดุงุก ุชูุฑูุฑ ูุทูู ููุฌุฒ ูู ุจูุงูุงุช ุงููููุฉ ุงููุถุงูุฉ ุงูุญููููุฉ.</p>
        <button class="btn" onclick="exportValueReport()">ุชุตุฏูุฑ CSV</button>
        <div id="exportHint" class="small"></div>
      </div>
    </div>
  </div>
</section>

<!-- GOV VALUE โ TABLE -->
<section id="govvalue-all" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุชูุงุตูู ุงููููุฉ ุงููุถุงูุฉ ุงูุญููููุฉ</h3>
      <div class="row"><div><input class="input" id="q" placeholder="ุงุจุญุซ ุนู ุฌูุฉ..."></div><div style="display:flex;align-items:end"><button class="btn" onclick="filterGovTable()">ุจุญุซ</button></div></div>
      <div style="overflow:auto;margin-top:8px">
        <table class="table" id="tblGV"><thead><tr><th>ุงูุฌูุฉ</th><th>ุงูุนููุงู ุงููุฎุชุตุฑ</th><th>ุงููุตู</th></tr></thead><tbody></tbody></table>
      </div>
    </div>
  </div>
</section>

<!-- FUNDING / SPONSORSHIPS WORKFLOW -->
<section id="funding" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุณูุฑ ููุงููุงุช ุงูุชูููู/ุงูุฑุนุงูุงุช</h3>
      <p class="small">ูุฑุงุญู: ุทูุจ โ ุชุฏููู โ ุงุนุชูุงุฏ ุฃููู โ ุงุนุชูุงุฏ ููุงุฆู. Admin/Manager ูุนุชูุฏููุ Operator ููููุฐ.</p>
      <div class="row">
        <div><label>ุนููุงู ุงูุทูุจ</label><input class="input" id="f_title" placeholder="ูุซุงู: ุฑุนุงูุฉ ูุนุงููุฉ ูุฌุชูุนูุฉ"></div>
        <div><label>ุงููููุฉ ุงูุชูุฏูุฑูุฉ (SAR)</label><input class="input" id="f_amount" type="number" min="0" step="1000" placeholder="100000"></div>
      </div>
      <div class="row">
        <div><label>ุงูุฌูุฉ/ุงูุญุณุงุจ</label>
          <select class="input" id="f_account">
            <option>ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู</option><option>ุงููุทุงุน ุงูุฎุงุต</option><option>ุงูุฌุงูุนุงุช</option><option>ุงูุญูููุฉ</option><option>ููุฆุงุช ุงูุชุทููุฑ</option>
          </select>
        </div>
        <div style="display:flex;align-items:end"><button class="btn" onclick="wfCreate()">ุฅุฑุณุงู ุงูุทูุจ</button></div>
      </div>
      <hr>
      <table class="table" id="wfTbl"><thead><tr><th>ุงูุนููุงู</th><th>ุงููููุฉ</th><th>ุงูุญุณุงุจ</th><th>ุงููุฑุญูุฉ</th><th>ุฅุฌุฑุงุกุงุช</th></tr></thead><tbody></tbody></table>
      <p class="small">ุงูุนุฑุถ ูุนูู ูุญูููุง ุนุจุฑ LocalStorageุ ููููู ุฑุจุทู ูุงุญููุง ุจู APIs ูุนููุฉ.</p>
    </div>
  </div>
</section>

<!-- DOCS -->
<section id="docs" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุงููุซุงุฆู ุงูุฑุณููุฉ</h3>
      <p class="small">ูุนุฑุถ ุฃู ูููุงุช ุฏุงุฎู ูุฌูุฏ <code>docs/</code> ุนูู ุงููุณุชูุฏุน.</p>
      <div id="docsList" class="grid grid-3"></div>
      <div class="center" style="margin-top:10px">
        <a class="btn" href="./docs/Hasseef_Official_Report_Main.pdf" target="_blank">ุชุญููู ุงููุซููุฉ ุงูุฑุณููุฉ</a>
      </div>
    </div>
  </div>
</section>

<!-- SUBSCRIPTIONS -->
<section id="subscriptions" class="kit">
  <div class="container grid grid-3">
    <div class="card"><h4>ุฃุณุงุณู</h4><p class="small">ูุจุฏุงูุฉ ุขููุฉ</p><ul class="small"><li>ุฅุฏุงุฑุฉ ูุดุงุฑูุน ุญุชู 25 ุนูุตุฑูุง</li><li>ูุญูุธุฉ ุฃุณุงุณูุฉ</li><li>Webhook ูุงุญุฏ</li><li>ูุณุชุฎุฏูุงู + ูุฑุงูุจ</li></ul><div class="center"><button class="btn">ุงุจุฏุฃ</button></div></div>
    <div class="card"><h4>ูุชูุฏู</h4><p class="small">ุงูุฃูุซุฑ ุงุณุชุฎุฏุงููุง</p><ul class="small"><li>ูุดุงุฑูุน ุบูุฑ ูุญุฏูุฏุฉ</li><li>ูุญูุธุฉ ุฐููุฉ ูุชูุงุฑูุฑ</li><li>ููุงุชูุญ API ูุชุนุฏุฏุฉ</li><li>5 ูุณุชุฎุฏููู + 3 ูุฑุงูุจูู</li></ul><div class="center"><button class="btn">ุงุฎุชุฑ</button></div></div>
    <div class="card"><h4>ูุชููุฒ</h4><p class="small">ูุคุณุณู</p><ul class="small"><li>ุญููููุฉ ูุตูุงุญูุงุช ูุชูุฏูุฉ</li><li>SLA</li><li>ุงุณุชุถุงูุฉ ุฎุงุตุฉ</li><li>ูุฏูุฑ ูุฌุงุญ</li></ul><div class="center"><button class="btn">ุชูุงุตู</button></div></div>
  </div>
</section>

<!-- SPONSORS -->
<section id="sponsors" class="kit">
  <div class="container grid grid-3">
    <div class="card"><h4>ุฑุงุนู ุงุณุชุฑุงุชูุฌู</h4><ul class="small"><li>ูููุฉ ูุดุชุฑูุฉ</li><li>ุชูุฑูุฑ ุฃุซุฑ ูุทูู</li><li>ูุณุงุญุงุช ุฑุฆูุณูุฉ</li></ul></div>
    <div class="card"><h4>ุจูุงุชููู</h4><ul class="small"><li>ุดุนุงุฑ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</li><li>ุชูุงุฑูุฑ ุฑุจุน ุณูููุฉ</li><li>ุฏุนูุงุช ุฑุณููุฉ</li></ul></div>
    <div class="card"><h4>ุฐูุจู</h4><ul class="small"><li>ุดุนุงุฑ ูู ุตูุญุงุช ุจุงุทููุฉ</li><li>ุชูุงุฑูุฑ ูุตู ุณูููุฉ</li><li>ูุญุชูู ุชุนุฑููู</li></ul></div>
    <div class="card"><h4>ูุถู</h4><ul class="small"><li>ุธููุฑ ูู ุตูุญุงุช ุงูุดุฑูุงุก</li><li>ูุดุฑุฉ ุฏูุฑูุฉ</li><li>ุญุถูุฑ ููุงุณุจุงุช</li></ul></div>
    <div class="card"><h4>ุจุฑููุฒู</h4><ul class="small"><li>ุฐูุฑ ูุดุฑูู ุฏุงุนู</li><li>ุชูุงุฑูุฑ ุณูููุฉ ุนุงูุฉ</li><li>ุฏุนูุงุช ูุญุฏูุฏุฉ</li></ul></div>
  </div>
</section>

<!-- SUPPORT -->
<section id="support" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุงูุฏุนู ุงูููู</h3>
      <div class="row">
        <div><label>ุงูููุถูุน</label><input class="input" id="s1" placeholder="ูุซุงู: ูุดููุฉ ุชุณุฌูู ุงูุฏุฎูู"></div>
        <div><label>ุงูุฃููููุฉ</label><select class="input" id="s2"><option>ุนุงุฏูุฉ</option><option>ุนุงุฌูุฉ</option><option>ุทุงุฑุฆุฉ</option></select></div>
      </div>
      <div><label>ุงูุชูุงุตูู</label><textarea class="input" id="s3" rows="5" placeholder="ุงุดุฑุญ ุงููุดููุฉ..."></textarea></div>
      <div style="text-align:end"><button class="btn" onclick="addTicket()">ุฅุฑุณุงู ุชุฐูุฑุฉ</button></div>
    </div>
    <div class="card">
      <h4>ุชุฐุงูุฑ ุณุงุจูุฉ</h4>
      <table class="table" id="tickets"><thead><tr><th>ุงูููุถูุน</th><th>ุงูุฃููููุฉ</th><th>ุงูุญุงูุฉ</th></tr></thead><tbody></tbody></table>
    </div>
  </div>
</section>

<!-- POLICIES -->
<section id="policies" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุงูุณูุงุณุงุช ูุงูุดุฑูุท</h3>
      <h4>ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</h4>
      <p class="small">ููุชุฒู ุจุญูุงูุฉ ุจูุงูุงุช ุงููุณุชุฎุฏููู ููู ุงูุฃูุธูุฉ ุงูุณุนูุฏูุฉ ููุนุงููุฑ ุงูุฃูุงู ุงููุทูู.</p>
      <h4>ุดุฑูุท ุงูุงุณุชุฎุฏุงู</h4>
      <ul class="small"><li>ุงุณุชุฎุฏุงู ูุณุคูู ูุฎุงูู ูู ุฅุณุงุกุฉ ุงูุฎุฏูุงุช.</li><li>ุงูุงูุชุฒุงู ุจูุนุงููุฑ ุงูุฑุคูุฉ 2030.</li><li>ุนุฏู ูุดุฑ ูุนูููุงุช ูุถููุฉ.</li></ul>
    </div>
  </div>
</section>

<!-- CONTACT -->
<section id="contact" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุงุชุตู ุจูุง</h3>
      <div class="row">
        <div><label>ุงูุงุณู</label><input class="input" placeholder="ุงูุงุณู ุงููุงูู"></div>
        <div><label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input class="input" placeholder="name@example.com"></div>
      </div>
      <div class="row">
        <div><label>ุงููุงุชู</label><input class="input" placeholder="+966 5x xxx xxxx"></div>
        <div><label>ููุน ุงูุฑุณุงูุฉ</label><select class="input"><option>ุงุณุชูุณุงุฑ</option><option>ููุชุฑุญ</option><option>ุจูุงุบ ุชููู</option><option>ุฑุนุงูุฉ/ุดุฑุงูุฉ</option></select></div>
      </div>
      <div><label>ุงูุฑุณุงูุฉ</label><textarea class="input" rows="5" placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..."></textarea></div>
      <div id="sent" class="card small hidden">ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ โ ุณูุนุงูุฏ ุงูุชูุงุตู ูุฑูุจูุง.</div>
      <div style="text-align:end"><button class="btn" onclick="document.getElementById('sent').classList.remove('hidden')">ุฅุฑุณุงู</button></div>
    </div>
    <div class="card">
      <h4>ุจูุงูุงุช ุงูุชูุงุตู ุงูุฑุณููุฉ</h4>
      <p class="small">ุงููุงุชู: +966 55 608 3172 โ ุงูุจุฑูุฏ: info@talbiya.sa โ ุงููููุน: https://talbiya.sa</p>
    </div>
  </div>
</section>

<!-- AGREEMENT -->
<section id="agreement" class="kit">
  <div class="container">
    <div class="card">
      <h3>ุงูุงุชูุงููุฉ ุงูุฑูููุฉ</h3>
      <ul class="small"><li>ุงูุงูุชุฒุงู ุจุงูุฃูุธูุฉ ุงูุณุนูุฏูุฉ ูุณูุงุณุงุช ุงูุฎุตูุตูุฉ.</li><li>ุงุณุชุฎุฏุงู ูุณุคูู ูุฎุฏูุงุช ุงูููุตุฉ.</li><li>ุญูุงูุฉ ุงูุจูุงูุงุช ูููุน ุฅุณุงุกุฉ ุงูุงุณุชุฎุฏุงู.</li><li>ุงูุงูุชุฒุงู ุจูุนุงููุฑ ุฑุคูุฉ 2030 ูุงูุฃุซุฑ ุงูุชูููู.</li></ul>
      <div class="center"><a class="btn" href="#login">ุนูุฏุฉ ูุจูุงุจุฉ ุงูุฏุฎูู</a></div>
    </div>
  </div>
</section>

<footer class="footer">
  <div class="container flex" style="justify-content:space-between">
    <div>ยฉ 2025 ููุตุฉ ุญุตูู โ ุชู ุฅุนุฏุงุฏ ุงููุซููุฉ ูู ูุจู ุดุฑูุฉ ุชูุจูุฉ ููุจุญุซ ูุงูุชุทููุฑ</div>
    <div class="logoRow">
      <a href="https://www.vision2030.gov.sa/" target="_blank"><img src="assets/vision2030.png" alt="vision" style="height:26px" onerror="this.style.display='none'"></a>
      <a href="https://talbiya.sa" target="_blank"><img src="assets/talbiya.png" alt="talbiya" style="height:26px" onerror="this.style.display='none'"></a>
    </div>
  </div>
</footer>

<!-- VALUE MODAL -->
<div class="modal" id="valueModal" onclick="if(event.target===this) closeModals()">
  <div class="box">
    <h4 class="title"></h4>
    <p class="body"></p>
    <div class="center"><button class="badge" onclick="closeModals()">ุญุณููุง</button></div>
  </div>
</div>

<!-- AGREEMENT POPUP -->
<div class="modal" id="agreementModal">
  <div class="box">
    <h4>ุงูุงุชูุงููุฉ ุงูุฑูููุฉ</h4>
    <p class="small">ูุฌุจ ุงูููุงููุฉ ุนูู ุงุชูุงููุฉ ุงูุงุณุชุฎุฏุงู ูุจู ุฅูุดุงุก ุงูุญุณุงุจ ุฃู ุงูุฏุฎูู.</p>
    <div class="card" style="max-height:220px;overflow:auto">
      <p><strong>ุจููุฏ ูุฎุชุตุฑุฉ:</strong> ุงุณุชุฎุฏุงู ูุณุคููุ ุดูุงููุฉุ ุญูุงูุฉ ุงูุจูุงูุงุชุ ุงูุงูุชุฒุงู ุจุฃูุฏุงู ุฑุคูุฉ 2030.</p>
    </div>
    <div class="flex" style="justify-content:flex-end">
      <button id="agreeCancel" class="badge">ุฅูุบุงุก</button>
      <button id="agreeAccept" class="btn">ููุงููุฉ ููุชุงุจุนุฉ</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
/*** i18n ***/
const i18n={ar:{home:"ุงูุฑุฆูุณูุฉ",about:"ุนู ุงูููุตุฉ",accounts:"ุงูุญุณุงุจุงุช",govValue:"ุงููููุฉ ุงูุญููููุฉ",subscriptions:"ุจุงูุงุช ุงูุงุดุชุฑุงู",sponsors:"ูุฆุงุช ุงูุฑุนุงูุฉ",support:"ุงูุฏุนู ุงูููู",policies:"ุงูุณูุงุณุงุช ูุงูุดุฑูุท",contact:"ุงุชุตู ุจูุง",download:"ุชุญููู ุงููุซููุฉ ุงูุฑุณููุฉ",login:"ุชุณุฌูู ุงูุฏุฎูู",map:"ุงูุฎุฑุงุฆุท",docs:"ุงููุซุงุฆู",funding:"ุงูุชูููู/ุงูุฑุนุงูุงุช",admin:"ุงูุฅุฏุงุฑุฉ",register:"ุชุณุฌูู"},en:{home:"Home",about:"About",accounts:"Accounts",govValue:"Government Added Value",subscriptions:"Subscriptions",sponsors:"Sponsors",support:"Support",policies:"Policies",contact:"Contact",download:"Download Official Document",login:"Sign In",map:"Maps",docs:"Documents",funding:"Funding/Sponsorship",admin:"Admin",register:"Register"}};
function currentLang(){return localStorage.getItem('lang')||'ar'}
function setLang(lang){localStorage.setItem('lang',lang);document.documentElement.lang=lang==='ar'?'ar':'en';document.documentElement.dir=lang==='ar'?'rtl':'ltr';document.querySelectorAll("[data-i18n]").forEach(el=>{const k=el.getAttribute('data-i18n');el.textContent=i18n[lang][k]||el.textContent;});}
document.addEventListener('DOMContentLoaded',()=>{setLang(currentLang());});

/*** Router ***/
const sections=[...document.querySelectorAll('.kit')];
function route(){
  const id=(location.hash||'#home').replace('#','');
  sections.forEach(s=>s.style.display=s.id===id?'block':'none');
  document.querySelectorAll('#topNav a').forEach(a=>a.classList.toggle('active',a.getAttribute('href')==='#'+id));
  if(id==='home'){renderGovCards();}
  if(id==='govvalue-all'){renderGovTable();}
  if(id==='login'){renderAccounts();}
  if(id==='dashboard'){initCharts();renderDashboard();}
  if(id==='admin'){renderUsers();}
  if(id==='map'){renderMap();bindSvgMap();}
  if(id==='docs'){renderDocs();}
  if(id==='funding'){wfRender();}
}
window.addEventListener('hashchange',route);route();

/*** Theme (Dark/Light) ***/
(function(){
  const root=document.documentElement;
  const saved=localStorage.getItem('theme')||'light';
  if(saved==='dark'){root.classList.add('dark');}
  document.getElementById('themeBtn')?.addEventListener('click',()=>{
    root.classList.toggle('dark');
    localStorage.setItem('theme', root.classList.contains('dark')?'dark':'light');
  });
})();

/*** Monochrome SVG icons ***/
const ico = {
  person:`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" stroke="#475569" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="6.5" r="4"/><path d="M4 20a8 8 0 0 1 14 0"/></svg>`,
  bldg:`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" stroke="#475569" fill="none" stroke-width="2"><rect x="3" y="3" width="16" height="16" rx="2"/><path d="M7 7h8M7 11h8M7 15h8"/></svg>`,
  gov:`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" stroke="#475569" fill="none" stroke-width="2"><path d="M3 10h18l-9-6-9 6z"/><path d="M4 10v10h16V10"/><path d="M8 14v6M12 14v6M16 14v6"/></svg>`,
  uni:`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" stroke="#475569" fill="none" stroke-width="2"><path d="M2.5 10.5 11 6l8.5 4.5L11 15z"/><path d="M5 12v4l6 3 6-3v-4"/></svg>`,
  heart:`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" stroke="#475569" fill="none" stroke-width="2"><path d="M20.8 7.6a5.5 5.5 0 0 0-7.8 0L11 9.6l-2-2a5.5 5.5 0 0 0-7.8 7.8L11 22l9.8-6.6a5.5 5.5 0 0 0 0-7.8z"/></svg>`,
  handshake:`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" stroke="#475569" fill="none" stroke-width="2"><path d="M8 11l3-3 3 3M2 12l6 6 3-3 3 3 6-6"/></svg>`,
  cog:`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" stroke="#475569" fill="none" stroke-width="2"><path d="M12 1v3M12 20v3M4.2 4.2l2.1 2.1M17.7 17.7l2.1 2.1M1 12h3M20 12h3M4.2 19.8l2.1-2.1M17.7 6.3l2.1-2.1"/><circle cx="12" cy="12" r="4"/></svg>`,
  map:`<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" stroke="#475569" fill="none" stroke-width="2"><path d="M9 18l-6 3V6l6-3 6 3 6-3v15l-6 3-6-3z"/><path d="M9 3v15M15 6v15"/></svg>`
};

/*** GOV VALUE DATA ***/
window.govValues=[
 {id:'mep',name:'ูุฒุงุฑุฉ ุงูุงูุชุตุงุฏ ูุงูุชุฎุทูุท',brief:'ููุงุกูุฉ ุงูุฃุฏุงุก ุงููุทูู',detail:'ุฑุจุท ุงููุจุงุฏุฑุงุช ุจูุคุดุฑุงุช ุฑุคูุฉ 2030 ูุชุญููู ุงููุฌูุงุช ุงูุชููููุฉ ูุฅุตุฏุงุฑ ุชูุงุฑูุฑ ููุญุฏุฉ.'},
 {id:'mof',name:'ูุฒุงุฑุฉ ุงููุงููุฉ',brief:'ููุงุกุฉ ุงูุฅููุงู',detail:'ุชุชุจุน ุงูุชูููู ุงูุชูููู ูุชุญุณูู ุงูุนุงุฆุฏ ุนุจุฑ ูุญูุธุฉ ุงูููุญ ูุงูุงุณุชุซูุงุฑ ูุงูุงุดุชุฑุงู ูุงูุฑุนุงูุฉ.'},
 {id:'moi',name:'ูุฒุงุฑุฉ ุงูุฏุงุฎููุฉ (ุฅูุงุฑุงุช ุงูููุงุทู)',brief:'ุชูุงูู ุงูููุงุทู',detail:'ุชูุญูุฏ ุงูุชูุงุฑูุฑ ุงูููุงููุฉ ูุฅุฏุงุฑุฉ ุงููุดุงุฑูุน ุนูู ูุณุชูู ุงูููุงุทู ูุน ููุธููุฉ ููุงููุงุช.'},
 {id:'dev',name:'ููุฆุงุช ุชุทููุฑ ุงูููุงุทู',brief:'ุชูููู ุงูุชุทููุฑ ุงููุญูู',detail:'ูุชุงุจุนุฉ ุงููุจุงุฏุฑุงุช ุงูุชููููุฉ ูุฑุจุทูุง ุจูุคุดุฑุงุช ุงูุฃุซุฑ ูุชูุณูู ุงูุดุฑุงูุงุช ูุน ุงููุทุงุน ุงูุฎุงุต ูุงูุฌุงูุนุงุช.'},
 {id:'moe',name:'ูุฒุงุฑุฉ ุงูุชุนููู',brief:'ุงูุชุนุฒูุฒ ุงูุนููู',detail:'ุฅุดุฑุงู ุงูุฌุงูุนุงุช ููุฑุงูุฒ ุงุณุชุดุงุฑูุฉ ุนูููุฉ ูุฅุชุงุญุฉ ูุฑุต ุงูุชุฏุฑูุจ ุงูุชุนุงููู.'},
 {id:'moc',name:'ูุฒุงุฑุฉ ุงูุซูุงูุฉ',brief:'ุงููููุฉ ุงููุทููุฉ',detail:'ุฏุนู ุงููุจุงุฏุฑุงุช ุงูุซูุงููุฉ ุฐุงุช ุงูุฃุซุฑ ูุฑุจุทูุง ุจุฑุนุงูุงุช ุงููุทุงุน ุงูุฎุงุต.'},
 {id:'mot',name:'ูุฒุงุฑุฉ ุงูุณูุงุญุฉ',brief:'ุงูุงูุชุตุงุฏ ุงููุญูู',detail:'ุชุทููุฑ ุงููุดุงุฑูุน ุงูุณูุงุญูุฉ ุจุงูุชุนุงูู ูุน ุงูุฌูุงุช ุบูุฑ ุงูุฑุจุญูุฉ ูุงููุณุชุซูุฑูู.'},
 {id:'moh',name:'ูุฒุงุฑุฉ ุงูุตุญุฉ',brief:'ุฌูุฏุฉ ุงูุญูุงุฉ',detail:'ุชุญููุฒ ูุจุงุฏุฑุงุช ุงูุตุญุฉ ุงููุฌุชูุนูุฉ ูุชุนุฒูุฒ ุงูููุงูุฉ ูุงููุดุงุฑูุฉ ุงูุชุทูุนูุฉ.'},
 {id:'mcit',name:'ูุฒุงุฑุฉ ุงูุงุชุตุงูุงุช ูุชูููุฉ ุงููุนูููุงุช',brief:'ุงูุชุญูู ุงูุฑููู',detail:'ุชูููู ุงูุญููู ุงูุชูููุฉ ูุชูุงูู ุงูุจูุงูุงุช ุงูุญููููุฉ ููู ูุนุงููุฑ ุงูุฃูุงู.'},
 {id:'adaa',name:'ูุฑูุฒ ุฃุฏุงุก',brief:'ููุงุณ ุงูุฃุซุฑ',detail:'ุชูุญูุฏ ุฃุฏูุงุช ููุงุณ ุงูุฃุฏุงุก ูุฑุจุทูุง ุจููุญุงุช ุงูููุตุฉ ุงูุชุญููููุฉ.'},
 {id:'ncdc',name:'ุงููุฑูุฒ ุงููุทูู ูุชูููุฉ ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู',brief:'ุชูููู ุงูููุธูุงุช',detail:'ุฑูุน ููุงุกุฉ ุงูููุธูุงุช ูุฑุจุทูุง ุจุงููููููู ูุงูุดุฑูุงุก.'},
 {id:'monshaat',name:'ููุดุขุช',brief:'ุฏุนู ุงูููุดุขุช ุงูุตุบูุฑุฉ',detail:'ุชุญููุฒ ุงูุดุฑูุงุช ุงูุตุบูุฑุฉ ุนุจุฑ ูุฑุต ุงูุฑุนุงูุฉ ูุงูุงุณุชุซูุงุฑ ูุงููุณุคูููุฉ ุงูุงุฌุชูุงุนูุฉ.'}
];

/*** GOV VALUE CARDS + TABLE ***/
function renderGovCards(){
  const el=document.getElementById('govValueCards');
  el.innerHTML=window.govValues.map(v=>`
    <div class="tile">
      <div class="icon">${ico.bldg}</div>
      <div>
        <h4>${v.name}</h4>
        <p class="small">${v.brief}</p>
        <p><button class="badge" onclick="showValue('${v.id}')">ุนุฑุถ ุงูุชูุงุตูู</button></p>
      </div>
    </div>`).join('');
}
function showValue(id){
  const m=document.getElementById('valueModal');
  const d=window.govValues.find(x=>x.id===id);
  if(!d)return;
  m.querySelector('.title').textContent=d.name;
  m.querySelector('.body').textContent=d.detail;
  m.style.display='flex';
}
function closeModals(){document.querySelectorAll('.modal').forEach(m=>m.style.display='none');}
function renderGovTable(){
  const tb=document.querySelector('#tblGV tbody');tb.innerHTML='';
  (window.govValues||[]).forEach(v=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${v.name}</td><td>${v.brief}</td><td>${v.detail}</td>`;
    tb.appendChild(tr);
  });
}
function filterGovTable(){
  const q=document.getElementById('q').value.trim().toLowerCase();
  document.querySelectorAll('#tblGV tbody tr').forEach(r=>{
    r.style.display=r.textContent.toLowerCase().includes(q)?'':'none';
  });
}

/*** ACCOUNTS LOGIN ***/
const accounts=[
 {key:'individual',name:'ุงูุฃูุฑุงุฏ',desc:'ููู ูุจุงุฏุฑุงุชุ ูุฑุตุ ูุญูุธุฉ.',icon:ico.person},
 {key:'private',name:'ุงููุทุงุน ุงูุฎุงุต',desc:'CSRุ ุฑุนุงูุฉุ ุชูุงุฑูุฑ ุฃุซุฑ.',icon:ico.bldg},
 {key:'nonprofit',name:'ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู',desc:'ูุดุงุฑูุนุ ูุชุทูุนููุ ุฃุซุฑ.',icon:ico.gov},
 {key:'universities',name:'ุงูุฌุงูุนุงุช',desc:'ุชุนุฒูุฒ ุนูููุ ุชุฏุฑูุจ ุชุนุงููู.',icon:ico.uni},
 {key:'government',name:'ุงูุญูููุฉ',desc:'ุญูููุ ูุนุงููุงุชุ ูุคุดุฑุงุช.',icon:ico.gov},
 {key:'donors',name:'ุงููุงูุญูู',desc:'ูุญูุธุฉ ูุงูุญ ูุชูุงุฑูุฑ.',icon:ico.heart},
 {key:'partners',name:'ุงูุดุฑูุงุก ุงูุงุณุชุฑุงุชูุฌููู',desc:'ููุญุงุช ูุทููุฉ.',icon:ico.handshake},
 {key:'dev_authorities',name:'ููุฆุงุช ุงูุชุทููุฑ',desc:'ูุดุงุฑูุน ุงูููุงุทู ูุงูุชูููุฉ.',icon:ico.map},
 {key:'admin',name:'ุฅุฏุงุฑุฉ ุงูููุตุฉ (Admin)',desc:'ุญูููุฉ ูุตูุงุญูุงุช ูุฑุจุท.',icon:ico.cog}
];
function renderAccounts(){
  const el=document.getElementById('accountTiles');
  el.innerHTML=accounts.map(a=>`
    <div class="tile">
      <div class="icon">${a.icon}</div>
      <div>
        <h4>${a.name}</h4>
        <p class="small">${a.desc}</p>
        <p><button class="badge" onclick="loginAs('${a.key}')">ุฏุฎูู</button></p>
      </div>
    </div>`).join('');
}
function openAgreement(onAccept){
  const modal=document.getElementById('agreementModal');
  modal.style.display='flex';
  modal.querySelector('#agreeAccept').onclick=()=>{modal.style.display='none';onAccept&&onAccept();};
  modal.querySelector('#agreeCancel').onclick=()=>{modal.style.display='none';};
}
function loginAs(account){
  openAgreement(()=>{localStorage.setItem('account',account); location.hash=(account==='admin')?'admin':'dashboard';});
}

/*** DASHBOARD ***/
function initCharts(){
  if(typeof Chart==='undefined')return;
  const g=document.getElementById('chartGrowth');
  if(g){
    new Chart(g,{type:'line',data:{labels:['1','2','3','4','5','6','7','8','9','10','11','12'],datasets:[{label:'ูุดุงุฑูุงุช',data:[20,24,22,28,30,35,40,44,48,52,58,65],tension:.35}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});
  }
  const d=document.getElementById('chartGrants');
  if(d){
    new Chart(d,{type:'doughnut',data:{labels:['ุงูุฃูุฑุงุฏ','ุงูุฎุงุต','ุบูุฑ ุงูุฑุจุญู','ุงูุฌุงูุนุงุช','ุงูุญูููุฉ','ุงููุงูุญูู'],datasets:[{data:[12,28,34,10,8,20]}]},options:{responsive:true,plugins:{legend:{position:'bottom'}}}});
  }
}
const servicesMap={
  individual:['ุฅุฏุฑุงุฌ ูุจุงุฏุฑุงุช','ุงูุชูุฏูู ุนูู ูุฑุต','ูุญูุธุฉ ูุฑุฏูุฉ','ุดูุงุฏุงุช ูููุฌุฒุงุช'],
  private:['ูุฑุต ููุญ ูุฑุนุงูุฉ','ุชูุงุฑูุฑ ุฃุซุฑ','ููุญุฉ CSR','ุฑุจุท ุญูููู'],
  nonprofit:['ุทุฑุญ ูุดุงุฑูุน','ุฌุฐุจ ูุชุจุฑุนูู','ุฅุฏุงุฑุฉ ูุชุทูุนูู','ุชุญููู ุฃุซุฑ'],
  universities:['ุชุนุฒูุฒ ุนููู','ุดุฑุงูุงุช ุจุญุซูุฉ','ุชุฏุฑูุจ ุชุนุงููู','ูุฑุงูู ุฌุงูุนูุฉ','ูุฑูุฒ ุงููุชุญุฏุซูู'],
  government:['ุทูุจ ุญููู','ุงุนุชูุงุฏ ูุนุงููุงุช','ูุคุดุฑุงุช ุงูููุงุทู','ููุงุกูุฉ ูุน ุงูุฑุคูุฉ','ุณุฌู ุงููุชุญุฏุซูู ุงููุนุชูุฏูู','ุณุฌู ุงููุฑุงูู','ุจุฑุงูุฌ ุงูุชุฏุฑูุจ ุงูุชุนุงููู'],
  donors:['ุชุตููุญ ูุฑุต ุงูููุญ','ูุญูุธุฉ ูุงูุญ','ุชูุงุฑูุฑ ุฃุซุฑ','ุชูุถููุงุช ุชูููู'],
  partners:['ููุญุงุช ูุทููุฉ','ุชุจุงุฏู ุจูุงูุงุช','ุจูุงุจุงุช ุฑุจุท','ููุงูุจ ููุงุณ'],
  dev_authorities:['ุฅุฏุงุฑุฉ ูุดุงุฑูุน ุงูููุงุทู','ุชูุณูู ุงูุดุฑุงูุงุช','ุชูุงุฑูุฑ ุฃุซุฑ ูุญูู','ุชูุงูู ูุน ุงูุฅูุงุฑุฉ','ูุงุนุฏุฉ ุจูุงูุงุช ุงููุฑุงูู','ุชูุณูู ุงููุชุญุฏุซูู','ุงูุชุฏุฑูุจ ุงูุชุนุงููู ูุน ุงูุฌุงูุนุงุช']
};
function renderDashboard(){
  const acc=localStorage.getItem('account')||'individual';
  document.getElementById('dashTitle').textContent='ููุญุฉ ุญุณุงุจ: '+acc;
  document.getElementById('rolesBox').textContent='Admin (ูุงูู ุงูุญุณุงุจ)ุ ูุฏูุฑุ ูุดุบููุ ูุฑุงูุจุ ุฒุงุฆุฑ';
  document.getElementById('servicesList').innerHTML=(servicesMap[acc]||[]).map(s=>`<li>โข ${s}</li>`).join('');
}

/*** MAP & KPIs ***/
const regions=[
  {id:'Hail',name:'ุญุงุฆู',jobs:72,grants:18,vols:220, dist:[12,18,22,10,8,20]},
  {id:'Riyadh',name:'ุงูุฑูุงุถ',jobs:310,grants:95,vols:920, dist:[20,28,34,12,10,26]},
  {id:'Makkah',name:'ููุฉ ุงูููุฑูุฉ',jobs:280,grants:88,vols:840, dist:[18,26,30,11,9,22]},
  {id:'Madinah',name:'ุงููุฏููุฉ ุงููููุฑุฉ',jobs:130,grants:42,vols:410, dist:[10,14,18,8,6,12]},
  {id:'Eastern',name:'ุงูุดุฑููุฉ',jobs:260,grants:74,vols:700, dist:[16,24,28,10,8,18]}
];
let mapChart;
function renderMap(){
  const sel=document.getElementById('regionSel'); if(!sel) return;
  sel.innerHTML=regions.map(r=>`<option value="${r.id}">${r.name}</option>`).join('');
  sel.onchange=()=>updateRegion(sel.value);
  updateRegion(regions[0].id);
}
function updateRegion(id){
  const r=regions.find(x=>x.id===id); if(!r) return;
  document.getElementById('kpiJobs').textContent=r.jobs;
  document.getElementById('kpiGrants').textContent=r.grants;
  document.getElementById('kpiVols').textContent=r.vols;
  if(typeof Chart==='undefined') return;
  const ctx=document.getElementById('mapChart'); if(!ctx) return;
  if(mapChart) mapChart.destroy();
  mapChart=new Chart(ctx,{
    type:'bar',
    data:{labels:['ุงูุฃูุฑุงุฏ','ุงูุฎุงุต','ุบูุฑ ุงูุฑุจุญู','ุงูุฌุงูุนุงุช','ุงูุญูููุฉ','ุงููุงูุญูู'],datasets:[{label:'ุงููุฑุต',data:r.dist}]},
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });
}
function bindSvgMap(){
  const svg=document.querySelector('#ksaMap svg');
  if(svg && !svg.dataset.bound){
    svg.dataset.bound='1';
    svg.querySelectorAll('[data-region]').forEach(el=>{
      el.style.cursor='pointer';
      el.addEventListener('click',()=> updateRegion(el.getAttribute('data-region')));
      el.addEventListener('mouseenter',()=> el.setAttribute('fill','#e2e8f0'));
      el.addEventListener('mouseleave',()=> el.setAttribute('fill','#e5e7eb'));
    });
  }
}

/*** ADMIN (users & roles & export) ***/
const users=JSON.parse(localStorage.getItem('users')||'[]');
function renderUsers(){
  const tb=document.querySelector('#usersTbl tbody');if(!tb)return;tb.innerHTML='';
  users.forEach((u,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${u.name}</td><td>${u.role}</td><td>${u.account}</td><td><button class='badge' onclick='delUser(${i})'>ุญุฐู</button></td>`;
    tb.appendChild(tr);
  });
}
function addUser(){
  const n=document.getElementById('uName').value.trim();
  const r=document.getElementById('uRole').value;
  const a=document.getElementById('uAccount').value;
  if(!n)return alert('ุงุฏุฎู ุงูุงุณู');
  users.push({name:n,role:r,account:a});
  localStorage.setItem('users',JSON.stringify(users));renderUsers();
}
function delUser(i){users.splice(i,1);localStorage.setItem('users',JSON.stringify(users));renderUsers();}
const rolesCfg=JSON.parse(localStorage.getItem('rolesCfg')||'{}');
function saveRole(){
  const role=document.getElementById('roleSel').value;
  const perms=document.getElementById('rolePerms').value.trim();
  rolesCfg[role]=perms;
  localStorage.setItem('rolesCfg',JSON.stringify(rolesCfg));
  const out=document.getElementById('rolesOut');if(out) out.textContent=JSON.stringify(rolesCfg,null,2);
}
document.addEventListener('DOMContentLoaded',()=>{const out=document.getElementById('rolesOut');if(out) out.textContent=JSON.stringify(rolesCfg,null,2);});
function exportValueReport(){
  const data=(window.govValues||[]).map(v=>`${v.name},${v.brief},${v.detail.replace(/\n/g,' ')}`);
  const csv="name,brief,detail\n"+data.join("\n");
  const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);a.download='Government_Added_Value_Report.csv';a.click();
  const hint=document.getElementById('exportHint');if(hint)hint.textContent='ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ (CSV).';
}

/*** WORKFLOW (Funding/Sponsorship) ***/
const wf=JSON.parse(localStorage.getItem('wf')||'[]');
const wfStages=['ุทูุจ','ุชุฏููู','ุงุนุชูุงุฏ ุฃููู','ุงุนุชูุงุฏ ููุงุฆู'];
function wfSave(){localStorage.setItem('wf',JSON.stringify(wf));}
function wfRender(){
  const tb=document.querySelector('#wfTbl tbody'); if(!tb) return; tb.innerHTML='';
  wf.forEach((it,i)=>{
    const nextStage=wfStages[it.stage+1]||'โ';
    const canApprove=['Admin','ูุฏูุฑ','Manager'].includes((JSON.parse(localStorage.getItem('users')||'[]')[0]?.role||'Admin'));
    tb.insertAdjacentHTML('beforeend',`
      <tr>
        <td>${it.title}</td>
        <td>${(+it.amount).toLocaleString('en')}</td>
        <td>${it.account}</td>
        <td>${wfStages[it.stage]}</td>
        <td>
          ${canApprove && it.stage<wfStages.length-1 ? `<button class="badge" onclick="wfNext(${i})">ูุฑุญูุฉ: ${nextStage}</button>`:''}
          <button class="badge" onclick="wfDel(${i})">ุญุฐู</button>
        </td>
      </tr>`);
  });
}
function wfCreate(){
  const t=document.getElementById('f_title').value.trim();
  const a=+document.getElementById('f_amount').value||0;
  const acc=document.getElementById('f_account').value;
  if(!t) return alert('ุฃุฏุฎู ุนููุงู ุงูุทูุจ');
  wf.push({title:t,amount:a,account:acc,stage:0,created:Date.now()});
  wfSave(); wfRender();
}
function wfNext(i){ if(wf[i].stage<wfStages.length-1){wf[i].stage++; wfSave(); wfRender();} }
function wfDel(i){ wf.splice(i,1); wfSave(); wfRender(); }

/*** SUPPORT TICKETS ***/
const tickets=JSON.parse(localStorage.getItem('tickets')||'[]');
function renderTickets(){
  const tb=document.querySelector('#tickets tbody');if(!tb)return;tb.innerHTML='';
  tickets.forEach(t=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${t.t}</td><td>${t.p}</td><td>${t.s}</td>`;tb.appendChild(tr);});
}
function addTicket(){tickets.push({t:document.getElementById('s1').value,p:document.getElementById('s2').value,s:'ููุชูุญุฉ'});localStorage.setItem('tickets',JSON.stringify(tickets));renderTickets();}
renderTickets();

/*** DOCS (static list) ***/
const docsStatic=[
  {name:'ุงููุซููุฉ ุงูุฑุณููุฉ ุงูุฑุฆูุณูุฉ', file:'Hasseef_Official_Report_Main.pdf'},
  {name:'ุงูููู ุงููุงูููู ูุงูุงุณุชุฑุงุชูุฌู', file:'Legal_Strategic_File.pdf'},
  {name:'ูุซููุฉ ุงููุธุงู ุงูุชูููุฐู ูุงูุชููู', file:'Executive_Tech_System.pdf'}
];
function renderDocs(){
  const el=document.getElementById('docsList'); if(!el) return;
  el.innerHTML=docsStatic.map(d=>`
    <div class="card">
      <h4>${d.name}</h4>
      <p class="small">ุงูููุน: ${d.file.split('.').pop().toUpperCase()}</p>
      <a class="btn" href="./docs/${d.file}" target="_blank">ุชุญููู</a>
    </div>`).join('');
}

/*** Registration (local demo) ***/
function doRegister(){
  const type=document.getElementById('regType').value;
  const name=(document.getElementById('regName').value||'Admin').trim();
  const email=(document.getElementById('regEmail').value||'').trim();
  const role=document.getElementById('regRole').value;
  const agree=document.getElementById('regAgree').checked;
  if(!agree){alert('ุงูุฑุฌุงุก ุงูููุงููุฉ ุนูู ุงูุงุชูุงููุฉ ุงูุฑูููุฉ');return;}
  const users=JSON.parse(localStorage.getItem('users')||'[]');
  users.unshift({name,role,account:type,email});
  localStorage.setItem('users',JSON.stringify(users));
  localStorage.setItem('account',type);
  location.hash='#dashboard';
  const msg=document.getElementById('regMsg');
  msg.classList.remove('hidden'); msg.textContent='ุชู ุฅูุดุงุก ุงูุญุณุงุจ ูุคูุชูุง ููุงุฎุชุจุงุฑ. ูููู ุฑุจุทู ูุงุญููุง ุจู APIs ูุนููุฉ.';
}

/*** Boot lang ***/
document.addEventListener('DOMContentLoaded',()=>{setLang(currentLang());});
</script>
</body>
</html>
